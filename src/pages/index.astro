---
import { getCollection } from 'astro:content';
import BaseLayout from '../components/layout/BaseLayout.astro';
import Container from '../components/ui/Container.astro';
import Card from '../components/ui/Card.astro';
import Button from '../components/ui/Button.astro';
import Tag from '../components/ui/Tag.astro';
import { SITE } from '../config/site';

// Fetch latest blog posts (limit to 3)
const allBlogPosts = await getCollection('blog', ({ data }) => data.draft !== true);
const latestPosts = allBlogPosts
  .sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime())
  .slice(0, 3);

// Fetch featured works
const allWorks = await getCollection('works');
const featuredWorks = allWorks
  .filter((work) => work.data.featured === true)
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
  .slice(0, 3);
---

<BaseLayout
  title={SITE.title}
  description={SITE.description}
>
  <!-- Hero Section -->
  <section class="py-20 md:py-32">
    <Container size="lg">
      <div class="max-w-3xl">
        <h1 class="text-4xl md:text-6xl font-bold mb-6 text-foreground dark:text-foreground-dark">
          Welcome to {SITE.title}
        </h1>
        <p class="text-xl md:text-2xl text-muted-foreground dark:text-muted-foreground-dark dark:text-muted-foreground-dark mb-8">
          {SITE.description}
        </p>
        <div class="flex flex-wrap gap-4">
          <Button href="/about" variant="primary" size="lg">About Me</Button>
          <Button href="/contact" variant="outline" size="lg">Get in Touch</Button>
        </div>
      </div>
    </Container>
  </section>

  <!-- Latest Blog Posts -->
  <section class="py-16 bg-muted dark:bg-muted-dark">
    <Container size="lg">
      <div class="flex justify-between items-center mb-8">
        <h2 class="text-3xl font-bold text-foreground dark:text-foreground-dark">
          Latest Articles
        </h2>
        <Button href="/blog" variant="ghost">View All →</Button>
      </div>

      {latestPosts.length > 0 ? (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {latestPosts.map((post) => (
            <Card hover class="flex flex-col h-full">
              <div class="flex-1">
                <h3 class="text-xl font-semibold mb-2 text-foreground dark:text-foreground-dark">
                  <a href={`/blog/${post.slug}`} class="hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
                    {post.data.title}
                  </a>
                </h3>
                <p class="text-muted-foreground dark:text-muted-foreground-dark dark:text-muted-foreground-dark mb-4">
                  {post.data.description}
                </p>
                <div class="flex flex-wrap gap-2 mb-4">
                  {post.data.tags.slice(0, 3).map((tag) => (
                    <Tag size="sm">{tag}</Tag>
                  ))}
                </div>
              </div>
              <div class="text-sm text-muted-foreground dark:text-muted-foreground-dark dark:text-muted-foreground-dark">
                {post.data.pubDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
              </div>
            </Card>
          ))}
        </div>
      ) : (
        <Card>
          <p class="text-center text-muted-foreground dark:text-muted-foreground-dark dark:text-muted-foreground-dark py-8">
            No blog posts yet. Check back soon!
          </p>
        </Card>
      )}
    </Container>
  </section>

  <!-- Featured Works -->
  <section class="py-16">
    <Container size="lg">
      <div class="flex justify-between items-center mb-8">
        <h2 class="text-3xl font-bold text-foreground dark:text-foreground-dark">
          Featured Works
        </h2>
        <Button href="/works" variant="ghost">View All →</Button>
      </div>

      {featuredWorks.length > 0 ? (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {featuredWorks.map((work) => (
            <Card hover class="flex flex-col h-full">
              <div class="flex-1">
                <div class="flex items-center gap-2 mb-3">
                  <Tag
                    variant={work.data.type === 'research' ? 'primary' : work.data.type === 'project' ? 'success' : 'default'}
                    size="sm"
                  >
                    {work.data.type}
                  </Tag>
                </div>
                <h3 class="text-xl font-semibold mb-2 text-foreground dark:text-foreground-dark">
                  <a href={`/works/${work.slug}`} class="hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
                    {work.data.title}
                  </a>
                </h3>
                <p class="text-muted-foreground dark:text-muted-foreground-dark dark:text-muted-foreground-dark mb-4">
                  {work.data.description}
                </p>
                <div class="flex flex-wrap gap-2 mb-4">
                  {work.data.tags.slice(0, 3).map((tag) => (
                    <Tag size="sm">{tag}</Tag>
                  ))}
                </div>
              </div>
              <div class="text-sm text-muted-foreground dark:text-muted-foreground-dark dark:text-muted-foreground-dark">
                {work.data.date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
              </div>
            </Card>
          ))}
        </div>
      ) : (
        <Card>
          <p class="text-center text-muted-foreground dark:text-muted-foreground-dark dark:text-muted-foreground-dark py-8">
            No featured works yet. Check back soon!
          </p>
        </Card>
      )}
    </Container>
  </section>

  <!-- Call to Action -->
  <section class="py-16 bg-primary-50 dark:bg-primary-950/20">
    <Container size="md">
      <div class="text-center">
        <h2 class="text-3xl font-bold mb-4 text-foreground dark:text-foreground-dark">
          Let's Connect
        </h2>
        <p class="text-lg text-muted-foreground dark:text-muted-foreground-dark dark:text-muted-foreground-dark mb-8">
          Interested in collaborating or have questions? Feel free to reach out!
        </p>
        <div class="flex flex-wrap justify-center gap-4">
          <Button href="/contact" variant="primary" size="lg">Contact Me</Button>
          <Button href="/about" variant="outline" size="lg">Learn More</Button>
        </div>
      </div>
    </Container>
  </section>
</BaseLayout>
